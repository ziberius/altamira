function obtenerComuna(o){switch(o){case"1":return"Iquique";case"2":return"Alto Hospicio";case"3":return"Pozo Almonte";case"4":return"Pica";default:return""}}function obtenerTipo(o){switch(o){case"1":return"Venta";case"2":return"Arriendo"}}function showMessage(o){$("#btnNotificacion").click(),$("<div class='alert alert-danger alert-dismissible fade in notificacion'\n     role='alert'><button id='btnNotificacion' type='button' class='close'\n     data-dismiss='alert' aria-label='Cerrar'><span aria-hidden='true'>&times;\n    </span></button><strong>Notificación</strong><p>"+o+"</p></div>").appendTo("#main").fadeIn()}function ufToNumber(o){if(void 0!==o&&null!==o){var e=o.replace(".","");return e=e.replace(",","."),Number(e)}return 0}function addCommas(o){var e=String(o);e=e.replace(".",","),e+="";for(var t=e.split(","),a=t[0],r=t.length>1?","+t[1]:"",i=/(\d+)(\d{3})/;i.test(a);)a=a.replace(i,"$1.$2");return a+r}var scotchApp=angular.module("scotchApp",["ngRoute","ngAnimate","ngTouch","uiGmapgoogle-maps","ngclipboard"]);scotchApp.factory("Scopes",function(){var o={};return{store:function(e,t){o[e]=t},get:function(e){return o[e]}}}),scotchApp.service("modales",function(o,e,t,a){this.compartir=function(){var o=a.get("myCtrl");o.submitButtonDisabled=!1,o.submitted=!1,o.resultMessage="",o.result="",o.formData={},o.formData.inputName="",o.formData.inputRemitente="",o.formData.inputDestinatario="",o.formData.inputSubject="Mira  esta propiedad",o.formData.inputMessage="Hola! Estaba viendo la página de Altamira y vi esta propiedad que te podría interesar.",$("#detallePropiedad").modal("hide"),$("#compartirModal").modal("show")},this.mapa=function(){var e=a.get("myCtrl");$("#detallePropiedad").modal("hide"),o.path("/mapa/"+e.id_prop)},this.imprimir=function(){var o=$(".panel-body").html(),e=window.open("","_blank","width=300,height=300");e.document.open(),e.document.write('<html><head><link rel="stylesheet" type="text/css" href="style.css" /></head><body onload="window.print()">'+o+"</body></html>"),e.document.close()},this.contacto=function(){o.path("/contacto")},this.submitContacto=function(o){var r=a.get("myCtrl");r.submitted=!0,r.submitButtonDisabled=!0;var i={remitente:r.formData.inputRemitente,destinatario:r.formData.inputDestinatario,nombre:r.formData.inputName,asunto:r.formData.inputSubject,mensaje:r.formData.inputMessage,idprop:r.id_prop};o.$valid?(e.loading=!0,t.post("../../main/server/share-form.php",i).then(function(o){e.loading=!1,o.data.success===!0?(r.submitButtonDisabled=!0,r.resultMessage=o.data.message,r.result="bg-success"):(r.submitButtonDisabled=!1,r.resultMessage=o.data.message,r.result="bg-danger")})):(r.submitButtonDisabled=!1,r.resultMessage="Error, favor ingrese todos los datos solicitados.",r.result="bg-danger")},this.copiadoExitoso=function(){showMessage("Se ha copiado la url de la propiedad al portapapeles.")},this.copiadoError=function(){showMessage("Error al copiar la url de la propiedad al portapapeles.")}}),scotchApp.config(function(o){o.when("/",{redirectTo:"/altamira"}).when("/altamira",{templateUrl:"../main/web/modulos/altamira.php",controller:"mainController"}).when("/mapa/:idprop",{templateUrl:"../main/web/modulos/mapa.php",controller:"mapaController"}).when("/mapa",{templateUrl:"../main/web/modulos/mapa.php",controller:"mapaController"}).when("/contacto",{templateUrl:"../main/web/modulos/contacto.php",controller:"contactoController"}).when("/servicios",{templateUrl:"../main/web/modulos/servicios.php",controller:"serviciosController"}).when("/entreganos-tu-propiedad",{templateUrl:"../main/web/modulos/entreganos-tu-propiedad.php",controller:"entregaPropiedadController"}).when("/view/:idprop",{templateUrl:"../main/web/modulos/view.php",controller:"viewController"})}),scotchApp.controller("viewController",function(o,e,t,a,r,i,n){n.store("myCtrl",o),e.pageClass="page-contacto";var s="codigo,titulo,strip_tags(descrip) as descrip,direccion_real,dire,tipo,comuna,clp,uf,construido,terreno,dormitorio,ban,operacion";params={type:"view",conditions:{select:s,where:{"f.id_prop":a.idprop}}},e.loading=!0,t.post("../../main/server/action.php",params).then(function(a){if(e.loading=!1,null!==a.data&&"OK"===a.data.status){var r=a.data.records[0];$(".navfoto").scrollTo("0",100),o._Index=0,o.inputCodigo=r.codigo,o.inputTitulo=r.titulo,o.inputRegion="Tarapacá (I)",o.inputTareaDesc=r.descrip,o.inputDireccion=r.direccion_real,o.inputTipo=obtenerTipo(r.operacion),o.inputComuna=obtenerComuna(r.comuna),o.inputPrecioUf=r.uf,o.inputPrecioClp=r.clp,o.inputPrecioClpCalc=addCommas(r.uf*ufToNumber(e.valoruf)),o.inputConstruido=r.construido,o.inputTerreno=r.terreno,o.inputDormitorios=r.dormitorio,o.inputBanos=r.ban,o.id_prop=r.id_prop,params={type:"fotos",conditions:{select:"numero,id_prop",where:{id_prop:r.id_prop},order_by:"orden asc"}},e.loading=!0,t.post("../../main/server/action.php",params).then(function(t){if(e.loading=!1,null!==t.data&&"OK"===t.data.status){var a,i,n=1;o.photos=[];for(var s=0;s<t.data.records.length;s++)i={},a={},a=t.data.records[s],i.src="../../desk/img/propiedad/"+a.id_prop+"/grande/"+a.numero+".jpeg",i.id="foto"+n,o.photos.push(i),n++}else o.photos=[],i={},i.src="../../desk/img/propiedad/"+r.id_prop+"/grande/0.jpeg",i.id="foto1",o.photos.push(i)})}else o.propiedad=null,showMessage("No se encontraron resultados")}).catch(function(o){showMessage("Error al obtener las propiedades. El servidor respondió: "+o.statusText),e.loading=!1}),o._Index=0,o.isActive=function(e){return o._Index===e},o.showPrev=function(){0===o._Index?$(".navfoto").scrollTo("max",100):$(".navfoto").scrollTo("-=86px",100),o._Index=o._Index>0?--o._Index:o.photos.length-1},o.showNext=function(){o._Index=o._Index<o.photos.length-1?++o._Index:0,0===o._Index?$(".navfoto").scrollTo("0",100):$(".navfoto").scrollTo("+=86px",100)},o.showPhoto=function(e){o._Index=e},o.contacto=i.contacto,o.imprimir=i.imprimir,o.compartir=i.compartir,o.mapa=i.mapa,o.submit=i.submitContacto,o.onSuccess=i.copiadoExitoso,o.onError=i.copiadoError}),scotchApp.controller("mainController",function(o,e,t,a,r,i,n){n.store("myCtrl",o),n.store("main",o),o.destacados=!1,o.message="Bienvenido a Altamira Propiedades.",o.formData={},o.formData.inputOperacion="VENTA",o.modalEntrega=function(){o.formData={},o.formData.inputOperacion="VENTA",o.submitButtonDisabled=!1,o.submitted=!1,o.resultMessage="",o.result="",o.formData.inputName="",o.formData.inputEmail="",o.formData.inputTelefono="",o.formData.inputSubject="",o.formData.inputMessage="",$("#entregaPropModal").modal("show")},o.mostrarMenu=function(){$("#menuXs").show(),$("#menuXs").animate({width:"150px"},500)},o.esconderMenu=function(){$("#menuXs").animate({width:"0px"},500,function(){$("#menuXs").hide()})},o.detalle=function(o){$("#propDestacadasModal").modal("hide"),r.path("/view/"+o.id_prop)},o._Index=0,o.isActive=function(e){return o._Index===e},o.showPrev=function(){0===o._Index?$(".navfoto").scrollTo("max",100):$(".navfoto").scrollTo("-=86px",100),o._Index=o._Index>0?--o._Index:o.photos.length-1},o.showNext=function(){o._Index=o._Index<o.photos.length-1?++o._Index:0,0===o._Index?$(".navfoto").scrollTo("0",100):$(".navfoto").scrollTo("+=86px",100)},o.showPhoto=function(e){o._Index=e},o.contacto=i.contacto,o.imprimir=i.imprimir,o.compartir=i.compartir,o.mapa=i.mapa,o.onSuccess=i.copiadoExitoso,o.onError=i.copiadoError,o.submit=function(a){o.submitted=!0,o.submitButtonDisabled=!0;var r={correo:o.formData.inputEmail,nombre:o.formData.inputName,telefono:o.formData.inputTelefono,asunto:o.formData.inputSubject,mensaje:o.formData.inputMessage,operacion:o.formData.inputOperacion,tipo:"ENTREGUENOS"};a.$valid?(e.loading=!0,t.post("../../main/server/contact-form.php",r).then(function(t){e.loading=!1,t.data.success===!0?(o.submitButtonDisabled=!0,o.resultMessage=t.data.message,o.result="bg-success"):(o.submitButtonDisabled=!1,o.resultMessage=t.data.message,o.result="bg-danger")})):(o.submitButtonDisabled=!1,o.resultMessage=a.inputTelefono.$invalid?"* El teléfono debe contener máximo 10 digitos.":"* Error, favor validar los campos marcados con rojo.",o.result="bg-danger")},params={type:"moneda",conditions:{moneda:"UF"}},t.post("../../main/server/action.php",params).then(function(o){e.valoruf=null!==o.data&&"OK"===o.data.status?o.data.valor:"N/A"}).catch(function(o){showMessage("Error al obtener valor UF. El servidor respondió: "+o.statusText)}),o.modalPropiedades=function(){o.destacados?$("#propDestacadasModal").modal("show"):(params={type:"destacados"},e.loading=!0,t.post("../../main/server/action.php",params).then(function(t){e.loading=!1,null!==t.data&&"OK"===t.data.status?(o.valoruf=ufToNumber(e.valoruf),o.propaganda=t.data.records):(o.propaganda=null,showMessage("No se encontraron resultados")),$("#propDestacadasModal").modal("show"),a(function(){$("#propDestacadas").slick({slidesToShow:5,slidesToScroll:1,autoplay:!0,autoplaySpeed:3e3,adaptiveHeight:!0,pauseOnHover:!0,centerMode:!0,variableWidth:!0,prevArrow:'<button class="btn btnGaleriaDestLeft" ><i class="glyphicon glyphicon-chevron-left" ></i></button>',nextArrow:'<button class="btn btnGaleriaDestRight" ><i class="glyphicon glyphicon-chevron-right" ></i></button>',appendArrows:$("#propDestacadas")})}),o.destacados=!0}).catch(function(o){showMessage("Error al obtener las propiedades. El servidor respondió: "+o.statusText),e.loading=!1}))}}),scotchApp.controller("mapaController",function(o,e,t,a,r,i,n){i.store("myCtrl",o),o.message="Buscador de propiedades.",e.pageClass="page-buscar",o.prueba="",o.desc="",o.propiedades=[],o.moneda="UF",o.desde="",o.hasta="";var s="codigo,titulo,strip_tags(descrip) as descrip,uf,clp,tipo,construido,dormitorio,ban,comuna,mapa,direccion_real,dire,terreno,operacion";o.map={center:{latitude:-20.2428,longitude:-70.133},zoom:12,window:{marker:{},show:!1,closeClick:function(){this.show=!1},options:{pixelOffset:{height:-25,width:0}}}},o.markers={coordenadas:o.propiedades,markersEvents:{click:function(e,t,a){o.map.window.model=a,o.map.window.show=!0,o.propiedad=a},touch:function(e,t,a){o.map.window.model=a,o.map.window.show=!0,o.propiedad=a}},options:{icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}},o.getRecords=function(a){var r=n.idprop;void 0===r||null===r?"normal"===o.tipo?a={type:"view",conditions:{select:s,whereLike:{descrip:o.desc}}}:"avanzado"===o.tipo&&(a={type:"view",conditions:{select:s,whereLike:{descrip:o.desc},where:{tipo:o.tipoPropiedad,operacion:o.operacionPropiedad},precio:{tipo:o.moneda,desde:o.desde,hasta:o.hasta}}}):a={type:"view",conditions:{select:s,where:{"p.id_prop":r}}},"1"===o.operacionPropiedad?o.markers.options={icon:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}:"2"===o.operacionPropiedad&&(o.markers.options={icon:"http://maps.google.com/mapfiles/ms/icons/blue-dot.png"}),e.loading=!0,t.post("../../main/server/action.php",a).then(function(t){e.loading=!1,o.propiedades=[];var a={},r=1;null!==t.data&&"OK"===t.data.status?(angular.forEach(t.data.records,function(e){a={},a.codigo=e.codigo,a.titulo=e.titulo,a.descrip=e.descrip,a.direccion_real=e.direccion_real,a.tipo=e.tipo,a.tipoOperacion=obtenerTipo(e.operacion),a.operacion=e.operacion,a.comuna=obtenerComuna(e.comuna),a.id=r,a.id_prop=e.id_prop,a.numero=e.numero,a.dormitorio=e.dormitorio,a.ban=e.ban,a.uf=e.uf,a.clp=e.clp,a.construido=e.construido,a.terreno=e.terreno;var t=e.mapa.split(",");a.latitude=t[0],a.longitude=t[1],o.propiedades.push(a),r++}),o.markers.coordenadas=o.propiedades):(o.propiedades=[],showMessage("No se encontraron resultados"),o.markers.coordenadas=o.propiedades)}).catch(function(o){showMessage("Error al obtener las propiedades. El servidor respondió: "+o.statusText),e.loading=!1})},o.detalle=function(){$(".navfoto").scrollTo("0",100),o._Index=0;var a=o.propiedad;o.inputCodigo=a.codigo,o.inputTitulo=a.titulo,o.inputRegion="Tarapacá (I)",o.inputTareaDesc=a.descrip,o.inputDireccion=a.direccion_real,o.inputTipo=obtenerTipo(a.operacion),o.inputComuna=a.comuna,o.inputPrecioUf=a.uf,o.inputPrecioClp=a.clp,o.inputConstruido=a.construido,o.inputTerreno=a.terreno,o.inputDormitorios=a.dormitorio,o.inputBanos=a.ban,o.id_prop=a.id_prop,params={type:"fotos",conditions:{select:"numero,id_prop",where:{id_prop:a.id_prop},order_by:"orden asc"}},e.loading=!0,t.post("../../main/server/action.php",params).then(function(t){if(e.loading=!1,null!==t.data&&"OK"===t.data.status){var r,i,n=1;o.photos=[];for(var s=0;s<t.data.records.length;s++)i={},r={},r=t.data.records[s],i.src="../../desk/img/propiedad/"+r.id_prop+"/grande/"+r.numero+".jpeg",i.id="foto"+n,o.photos.push(i),n++;$("#detallePropiedad").modal("show")}else o.photos=[],i={},i.src="../../desk/img/propiedad/"+a.id_prop+"/grande/0.jpeg",i.id="foto1",o.photos.push(i),$("#detallePropiedad").modal("show")})},o._Index=0,o.isActive=function(e){return o._Index===e},o.showPrev=function(){0===o._Index?$(".navfoto").scrollTo("max",100):$(".navfoto").scrollTo("-=86px",100),o._Index=o._Index>0?--o._Index:o.photos.length-1},o.showNext=function(){o._Index=o._Index<o.photos.length-1?++o._Index:0,0===o._Index?$(".navfoto").scrollTo("0",100):$(".navfoto").scrollTo("+=86px",100)},o.showPhoto=function(e){o._Index=e},o.buscar=function(e){o.desc=$("#inputBuscar").val(),o.tipoPropiedad=$("#selectTipo").val(),o.operacionPropiedad=$("#selectOpe").val(),o.tipo=e,o.getRecords()},o.showPhoto=function(e){o._Index=e},o.contacto=function(){a.path("/contacto")},o.imprimir=r.imprimir,o.compartir=r.compartir,o.mapa=r.mapa,o.onSuccess=r.copiadoExitoso,o.onError=r.copiadoError,o.submit=r.submitContacto,o.buscar("avanzado")}),scotchApp.controller("destacadosController",function(o,e){o.message="Destacados",e.pageClass="page-destacados"}),scotchApp.controller("entregaPropiedadController",function(o,e){e.pageClass="page-contacto"}),scotchApp.controller("serviciosController",function(o,e){o.message="Servicios",e.pageClass="page-entrega-propiedad",o.accionesComerciales=function(){return o.administracionTexto="Aviso en Diario: Clasificados del diario La Estrella de Iquique.Avisos públicos: Instalación letrero publicitario en Inmueble.Visitas ejecutivo: Previa Coordinación.Medios Digitales: Alto tráfico web y Redes Sociales de Alto Impacto."},o.formalizacion=function(){return o.administracionTexto="Confección de Orden de Arriendo y Mandato de Administración.Acta de entrega de bien raíz.Acta de inventario y Levantamiento fotográfico.Carta de Informe Comunidad de Nuevo Arrendatario"},o.postventa1=function(){return o.administracionTexto="Liquidaciones de arriendo mensuales.Anticipos para gastos de toda índole.Pago de rentas en bancos con convenio.Depósitos a su cuenta corriente.Liquidaciones de renta en cualquier punto de Chile o el extranjero por correo postal o email.Comisiones de confianza (pago de contribuciones, dividendos, pensiones a terceros, etc)."},o.asistencia=function(){return o.administracionTexto="Participación en reuniones de asambleas ordinarias y extraordinarias de su comunidad.pago directo de sus contribuciones, con cargo a sus liquidaciones de egreso.asesoría en reparaciones e su bien inmueble asesoría legal.cobranzas extra judiciales gratuitas."}}),scotchApp.controller("contactoController",function(o,e,t,a){a.store("myCtrl",o),e.pageClass="page-contacto",o.result="hidden",o.resultMessage,o.formData={},o.formData.inputOperacion="VENTA",o.submitButtonDisabled=!1,o.submitted=!1,o.submit=function(a){o.submitted=!0,o.submitButtonDisabled=!0;var r={correo:o.formData.inputEmail,nombre:o.formData.inputName,telefono:o.formData.inputTelefono,asunto:o.formData.inputSubject,mensaje:o.formData.inputMessage,operacion:o.formData.inputOperacion,tipo:"CONTACTO"};a.$valid?(e.loading=!0,t.post("../../main/server/contact-form.php",r).then(function(t){e.loading=!1,t.data.success===!0?(o.submitButtonDisabled=!0,o.resultMessage=t.data.message,o.result="bg-success"):(o.submitButtonDisabled=!1,o.resultMessage=t.data.message,o.result="bg-danger")})):(o.submitButtonDisabled=!1,o.resultMessage=a.inputTelefono.$invalid?"* El teléfono debe contener máximo 10 digitos.":"* Error, favor validar los campos marcados con rojo.",o.result="bg-danger")}}),scotchApp.controller("userController",function(o,e,t,a,r,i){i.store("myCtrl",o),o.propiedades=[],o.tempUserData={},o.start=0,o.limit="10",o.end=o.start+parseInt(o.limit),o.tipo="normal",o.desc="",o.tipoPropiedad="",o.operacionPropiedad="";var n="codigo,titulo,strip_tags(descrip) as descrip,direccion_real,dire,tipo,comuna,clp,uf,construido,terreno,dormitorio,ban,operacion";o.anterior=function(){o.start=o.start-parseInt(o.limit)<0?0:o.start-parseInt(o.limit),o.getRecords()},o.siguiente=function(){o.start=o.start+parseInt(o.limit)>o.total+1?o.total-parseInt(o.limit)-1:o.start+parseInt(o.limit),o.getRecords()},o.buscar=function(e){o.desc=$("#inputBuscar").val(),o.tipoPropiedad=$("#selectTipo").val(),o.operacionPropiedad=$("#selectOpe").val(),o.tipo=e,o.start=0,o.getRecords()},o.cambioLimite=function(){o.end=o.start+parseInt(o.limit),o.getRecords()},o.getRecords=function(a){"normal"===o.tipo?a={type:"view",conditions:{select:n,start:o.start,limit:parseInt(o.limit),whereLike:{descrip:o.desc}}}:"avanzado"===o.tipo&&(a={type:"view",conditions:{select:n,start:o.start,limit:parseInt(o.limit),whereLike:{descrip:o.desc},where:{tipo:o.tipoPropiedad,operacion:o.operacionPropiedad}}}),e.loading=!0,t.post("../../main/server/action.php",a).then(function(t){e.loading=!1,o.valoruf=ufToNumber(e.valoruf),null!==t.data&&"OK"===t.data.status?(o.propiedades=t.data.records,o.total=t.data.total):(o.propiedades=null,o.total=0,showMessage("No se encontraron resultados")),o.end=o.start+parseInt(o.limit),o.end>o.total&&(o.end=o.total)}).catch(function(o){showMessage("Error al obtener las propiedades. El servidor respondió: "+o.statusText),e.loading=!1})},o.detalle=function(a){$(".navfoto").scrollTo("0",100),o._Index=0,o.inputCodigo=a.codigo,o.inputTitulo=a.dire,o.inputRegion="Tarapacá (I)",o.inputTareaDesc=a.descrip,o.inputDireccion=a.direccion_real,o.inputTipo=obtenerTipo(a.operacion),o.inputComuna=obtenerComuna(a.comuna),o.inputPrecioUf=a.uf,o.inputPrecioClp=a.clp,o.inputPrecioClpCalc=addCommas(a.uf*o.valoruf),o.inputConstruido=a.construido,o.inputTerreno=a.terreno,o.inputDormitorios=a.dormitorio,o.inputBanos=a.ban,o.id_prop=a.id_prop,"Venta"===o.inputTipo?(o.datosContacto1="Vende: Alberto Correa Marín",o.datosContacto2="Teléfonos: (57) 2 265288 / 9 9885 27 50 / 9 9417 57 93",o.datosContacto3="E-mail: acorrea@altamirapropiedades.cl"):(o.datosContacto1="Arrienda: Gabriela Lopez Sanchez",o.datosContacto2="Teléfonos: (57) 2 532860 / 9 9159 57 69 / 9 8139 53 57",o.datosContacto3="E-mail: glopez@altamirapropiedades.cl"),params={type:"fotos",conditions:{select:"numero,id_prop",where:{id_prop:a.id_prop},order_by:"orden asc"}},e.loading=!0,t.post("../../main/server/action.php",params).then(function(t){if(e.loading=!1,null!==t.data&&"OK"===t.data.status){var r,i,n=1;o.photos=[];for(var s=0;s<t.data.records.length;s++)i={},r={},r=t.data.records[s],i.src="../../desk/img/propiedad/"+r.id_prop+"/grande/"+r.numero+".jpeg",i.id="foto"+n,o.photos.push(i),n++;$("#detallePropiedad").modal("show")}else o.photos=[],i={},i.src="../../desk/img/propiedad/"+a.id_prop+"/grande/0.jpeg",i.id="foto1",o.photos.push(i),$("#detallePropiedad").modal("show")})},o._Index=0,o.isActive=function(e){return o._Index===e},o.showPrev=function(){0===o._Index?$(".navfoto").scrollTo("max",100):$(".navfoto").scrollTo("-=86px",100),o._Index=o._Index>0?--o._Index:o.photos.length-1},o.showNext=function(){o._Index=o._Index<o.photos.length-1?++o._Index:0,0===o._Index?$(".navfoto").scrollTo("0",100):$(".navfoto").scrollTo("+=86px",100)},o.showPhoto=function(e){o._Index=e},o.contacto=r.contacto,o.imprimir=r.imprimir,o.onSuccess=r.copiadoExitoso,o.onError=r.copiadoError,o.compartir=r.compartir,o.mapa=r.mapa,o.submit=r.submitContacto});